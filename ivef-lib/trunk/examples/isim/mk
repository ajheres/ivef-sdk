#
# cleanup
#
#rm -Rf classes/*
mkdir -p classes

#
# create a build tag
#
PREV_DATE=`cat src/isim/Version.java |grep "BUILD_TIME_STRING =" |cut -c 54-|cut -c -13`; 
NEW_DATE=`date -u +%Y%m%d-%H%M`; 

echo New build: $NEW_DATE, previous build: $PREV_DATE

cat src/isim/Version.java |sed s/${PREV_DATE}/${NEW_DATE}/ > /tmp/xxxxVersion.java
mv /tmp/xxxxVersion.java src/isim/Version.java

#
# compile the code
#

echo Building Support library
javac  -source 1.4 -classpath classes -d classes src/luky/*java src/luky/*/*java
echo Building ZLIB
javac  -source 1.4 -classpath classes -d classes src/com/jcraft/jzlib/*java
echo Beautifing source 
../../tools/astyle/bin/astyle --style=kr -n src/isim/*/* >/dev/null
echo Building Applications
javac -Xlint -source 1.4 -classpath classes:../../ivef-java/ivef/ivef.jar -d classes src/isim/*java src/isim/*/*java
echo Building ZIP Examples
#javac -source 1.4 -classpath classes -d classes src/example/*java

cd classes
#
# create a complete jar and a small jar
#

jar -cMf ../target/isim.jar *
